(window.webpackJsonp=window.webpackJsonp||[]).push([[7,27,42,75],{26:function(e,t){angular.module("graphdb.framework.rest.connectors.service",[]).factory("ConnectorsRestService",r),r.$inject=["$http"];const n="rest/connectors";function r(e){return{getConnectors:function(){return e.get(n)},initConnector:function(t){return e.get(`${n}/options?prefix=${t}`)},hasConnector:function(t){return e.get(`${n}/existing?prefix=${t}`)},checkConnector:function(t){return e.post(`${n}/check`,t,{headers:{"Content-Type":"text/plain"}})}}}},29:function(e,t,n){"use strict";n.r(t);n(5),n(10);function r(e,t,n,r,o,a,i,s,u,c,d,l,g,p){const f={id:"1",name:"",query:"select * where { \n\t?s ?p ?o .\n} limit 100 \n",inference:!0,sameAs:!0};let y,m=c.getPrincipal();function T(e,t){f.inference=t.appSettings.DEFAULT_INFERENCE,f.sameAs=t.appSettings.DEFAULT_SAMEAS,e.skipCountQuery=!t.appSettings.EXECUTE_COUNT,e.ignoreSharedQueries=t.appSettings.IGNORE_SHARED_QUERIES,e.tabsData=e.tabs=g.get(p.TABS_STATE)||[f],e.$watchCollection("[currentQuery.inference, currentQuery.sameAs]",function(e,t,n){b(n.currentQuery)}),e.$on("repositoryIsSet",S)}function b(t){e.tabs.forEach(function(n,r){n.id===t.id&&(e.tabs[r].query=t.query,e.tabs[r].inference=t.inference,e.tabs[r].sameAs=t.sameAs)}),g.set(p.TABS_STATE,e.tabs)}function C(t,n,r,o){const a=angular.element(document.getElementById("yasr-inner"));e.queryIsRunning=t,t?(e.queryStartTime=Date.now(),e.countTimeouted=!1,e.progressMessage=n,e.extraMessage=r,e.noLoaderTimer=o,a.addClass("hide")):(e.progressMessage="",e.extraMessage="",e.noLoaderTimer=!1,e.currentTrackAlias=null,e.abortRequested=!1,a.removeClass("hide")),null===e.$$phase&&e.$apply()}function w(n){function r(){return window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight||0}if(e.orientationViewMode){if("yasr"===e.viewMode){let e=r()-document.querySelector(".CodeMirror-wrap").getBoundingClientRect().top;e-=40,document.querySelector(".CodeMirror-wrap").style.height=e+"px"}else e.noPadding={},document.querySelector(".CodeMirror-wrap").style.height="";document.getElementById("yasr").style.minHeight=""}else if(e.noPadding={paddingRight:15,paddingLeft:0},window.editor&&document.querySelector(".CodeMirror-wrap")){let e=r()-document.querySelector(".CodeMirror-wrap").getBoundingClientRect().top;e-=40,document.querySelector(".CodeMirror-wrap").style.height=e+"px",document.getElementById("yasr").style.minHeight=e+"px"}else{let r;r=t(n?function(){e.fixSizesOnHorizontalViewModeSwitch(n)}:e.fixSizesOnHorizontalViewModeSwitch,100),e.$on("$destroy",function(){t.cancel(r)})}window.yasr&&window.yasr.container&&t(function(){window.yasr.container.resize()},100)}function h(){w(!0)}function S(t,n){n.newRepo&&(e.tabsData=g.get(p.TABS_STATE),e.tabsData.forEach(function(e){e.yasrData=void 0,e.queryType=void 0,e.resultsCount=0,e.allResultsCount=0,e.sizeDelta=void 0}),g.set(p.TABS_STATE,e.tabsData),e.tabs=e.tabsData,e.currentQuery={})}function v(e){t(function(){$('a[data-id = "'+e+'"]').tab("show")},0)}function Q(r,o){if(e.executedQueryTab=e.currentQuery,o&&"SELECT"!==window.editor.getQueryType()&&"CONSTRUCT"!==window.editor.getQueryType())n.warning("Explain only works with SELECT or CONSTRUCT queries.");else if(e.explainRequested=o,!e.queryIsRunning)if(r?e.currentTabConfig.resultsCount=0:e.resetCurrentTabConfig(),e.lastRunQueryMode=window.editor.getQueryMode(),C(!0,"update"===e.lastRunQueryMode?"Executing update":"Evaluating query"),"none"!==e.viewMode){e.viewMode="none",e.orientationViewMode&&e.fixSizesOnHorizontalViewModeSwitch();const n=t(window.editor.query,500);e.$on("$destroy",function(){t.cancel(n)})}else window.editor.query()}function E(){e.showSampleQueries=!e.showSampleQueries,e.showSampleQueries?i.getSavedQueries().success(function(t){e.sampleQueries=t,$("#sampleQueriesCollapse").collapse("show").width("300px")}).error(function(e){const t=getError(e);n.error(t,"Error! Could not get saved queries")}):$("#sampleQueriesCollapse").collapse("hide")}function q(t){let n=void 0;return e.tabsData.forEach(function(e){if(e.name===t.name&&e.query===t.body)return n=e.id,e}),n}function A(t){return function(n,r,o){e.savedQuery={name:n,query:r||window.editor.getValue(),shared:o},$(t).modal("show")}}function R(t){for(let n=0;n<e.tabsData.length;n++){if(e.tabsData[n].id===t)return n}}m?T(e,m):e.$on("securityInit",function(e){m=c.getPrincipal(),T(e.currentScope,m)}),e.resetCurrentTabConfig=function(){e.currentTabConfig={pageSize:1e3,page:1,allResultsCount:0,resultsCount:0}},e.queryExists=!1,e.resetCurrentTabConfig(),e.saveTab=function(t){const n=R(t);if(void 0===n)return{};const r=e.tabsData[n];return e.saveQueryToLocal(r),r},e.loadTab=function(n){e.tabsData=g.get(p.TABS_STATE)||[f];const r=R(n),o=e.tabsData[r];o.yasrData&&C(!0,"Rendering results",null,!0);t(function(){""===e.currentQuery.query&&(e.currentQuery.query=" "),t(function(){window.editor.setValue(e.currentQuery.query),e.yasr.updateDownloadDropdown(),e.$broadcast("tabLoaded",e.currentQuery.id),e.yasr.options.output=o.outputType,o.yasrData&&(o.yasrData.customError?(e.yasr.results={getException:function(){return o.yasrData.customError}},C(!1)):t(function(){e.yasr.setResponse(o.yasrData,o.textStatus,o.jqXhrOrErrorString),C(!1),$(".yasr_btnGroup li:nth-child(2)").hasClass("active")&&t(function(){$(".yasr_btnGroup li:nth-child(2) a").get(0).click()},0)},0))},0)},0),g.set(p.TABS_STATE_CURRENT_ID,n),e.currentQuery=o,t(function(){e.currentTabConfig={},e.currentTabConfig.queryType=o.queryType,e.currentTabConfig.resultsCount=o.resultsCount,e.currentTabConfig.offset=o.offset,e.currentTabConfig.allResultsCount=o.allResultsCount,e.currentTabConfig.page=o.page,e.currentTabConfig.pageSize=o.pageSize,e.currentTabConfig.timeFinished=o.timeFinished,e.currentTabConfig.timeTook=o.timeTook,e.currentTabConfig.sizeDelta=o.sizeDelta,e.currentTabConfig.customUpdateMessage=o.customUpdateMessage,e.currentTabConfig.errorMessage=o.errorMessage,e.currentTabConfig.warningMessage=o.warningMessage,e.$apply()},0),$("#yasr").css("padding","0"),y||(y=setInterval(x,200))},e.addNewTab=function(n,r,o){if(!k(!0))return;let a;a=r||o?{id:"1",name:r,query:o,inference:m.appSettings.DEFAULT_INFERENCE,sameAs:m.appSettings.DEFAULT_SAMEAS}:{id:"1",name:"",query:"select * where { \n\t?s ?p ?o .\n} limit 100 \n",inference:m.appSettings.DEFAULT_INFERENCE,sameAs:m.appSettings.DEFAULT_SAMEAS};const i=""+ ++D;e.tabsData=e.tabs;const s=a;s.id=i,e.tabsData.push(s),g.set(p.TABS_STATE_MAXID,D),g.set(p.TABS_STATE,e.tabsData);const u=Array.prototype.slice.call(arguments,1);t(function(){e.$apply(),v(i),n&&n.apply(this,u)},0),e.tabs=e.tabsData},e.isTabChangeOk=k,e.runQuery=Q,e.abortCurrentQuery=function(){l.abortQueryByAlias(e.currentTrackAlias).success(function(){e.abortRequested=!0})},e.editQuery=function(t){o.open({templateUrl:"js/angular/core/directives/queryeditor/templates/query-sample.html",controller:"QuerySampleModalCtrl",resolve:{data:function(){return{title:'Edit Saved Query: "'+t.name+'"',query:t,edit:!0,okButtonText:"Save"}}}}).result.then(function(r){const o={name:r.name,body:r.body,shared:r.shared};t.name!==r.name?i.addNewSavedQuery(o).success(function(){e.deleteQueryHttp(t.name,!0)}).error(function(e){const t=getError(e);n.error(t,"Error! Cannot edit saved query")}):i.editSavedQuery(o).success(function(){$("#editQueryContainer").modal("hide"),e.toggleSampleQueries(),n.success("Saved query "+t.name+" was edited.")}).error(function(e){const t=getError(e);n.error(t,"Error! Cannot edit Saved query")})})},e.getNamespaces=function(){C(!0,"Refreshing namespaces","Normally this is a fast operation but it may take longer if a bigger repository needs to be initialised first."),e.namespacesLoading=!0,d.getRepositoryNamespaces().success(function(t){const n={};t.results.bindings.forEach(function(e){n[e.prefix.value]=e.namespace.value}),e.namespaces=n}).error(function(t){e.repositoryError=getError(t)}).finally(function(){C(!1),e.namespacesLoading=!1})},e.changePagination=function(){Q(!0,e.explainRequested)},e.toggleSampleQueries=E,e.addKnownPrefixes=function(){i.addKnownPrefixes(JSON.stringify(window.editor.getValue())).success(function(e){angular.isDefined(window.editor)&&angular.isDefined(e)&&e!==window.editor.getValue()&&window.editor.setValue(e)}).error(function(e){const t=getError(e);return n.error(t,"Error! Could not add known prefixes"),!0})},e.getExistingTabId=q,e.querySelected=function(t){const n=q(t);e.toggleSampleQueries(),e.isTabChangeOk(!1)&&(e.highlightNextTabChange=!0,angular.isDefined(n)?v(n):e.addNewTab(null,t.name,t.body))},e.deleteQuery=function(t){a.openSimpleModal({title:"Confirm",message:"Are you sure you want to delete the saved query '"+t+"'?",warning:!0}).result.then(function(){e.deleteQueryHttp(t)})},e.deleteQueryHttp=function(t,r){i.deleteSavedQuery(t).success(function(){e.toggleSampleQueries(),r||n.success("Saved query: "+t+" was deleted.")}).error(function(e){const t=getError(e);n.error(t,"Error! Cannot delete saved query")})},e.saveQuery=function(t,n){o.open({templateUrl:"js/angular/core/directives/queryeditor/templates/query-sample.html",controller:"QuerySampleModalCtrl",resolve:{data:function(){return{title:"Create New Saved Query",query:{name:t.name,body:t.query,shared:t.shared},edit:!1,okButtonText:"Create",queryExists:n}}}}).result.then(function(t){e.saveQueryHttp(t)},function(){})},e.saveQueryHttp=function(t){i.addNewSavedQuery(t).success(function(){n.success("Saved query "+t.name+" was saved.")}).error(function(r){let o=getError(r);if(n.error(o,"Error! Cannot create saved query"),o="Query '"+t.name+"' already exists!"){t.query=t.body;const n=!0;e.saveQuery(t,n)}})},e.saveQueryToLocal=b,e.setLoader=C,e.getLoaderMessage=function(){const t=(Date.now()-e.queryStartTime)/1e3;let n="",r="";e.noLoaderTimer||(n=e.getHumanReadableSeconds(t));r=e.progressMessage?e.progressMessage+"... "+n:"Running operation... "+n;e.extraMessage&&t>10&&(r+="\n"+e.extraMessage);return r},e.fixSizesOnHorizontalViewModeSwitch=w,e.changeViewMode=function(){e.viewMode="none",e.orientationViewMode=!e.orientationViewMode,g.set(p.VIEW_MODE,e.orientationViewMode),w()},e.showHideEditor=h,e.focusQueryEditor=function(){angular.element(document).find(".editable-input").is(":focus")||angular.element(document).find(".CodeMirror textarea:first-child").focus()},e.orientationViewMode=!g.get(p.VIEW_MODE)||"true"===g.get(p.VIEW_MODE),e.viewMode="none",e.getActiveRepository=function(){return r.getActiveRepository()},e.getActiveRepositoryNoError=function(){if(!e.repositoryError)return r.getActiveRepository()},e.orientationViewMode||h(),window.onbeforeunload=function(){e.currentQuery&&e.saveTab(e.currentQuery.id),g.set(p.TABS_STATE,e.tabs)},e.$on("$destroy",function(){e.currentQuery&&e.saveTab(e.currentQuery.id),g.set(p.TABS_STATE,e.tabs),clearInterval(y)}),e.$on("$destroy",function(){clearInterval(y),window.editor=null,window.yasr=null}),$(document).mouseup(function(t){const n=$("#sampleQueriesCollapse");!n.is(t.target)&&0===n.has(t.target).length&&e.showSampleQueries&&E()});let D=g.get(p.TABS_STATE_MAXID)||1;function M(e){return $(e).attr("data-id")}function x(){if(e.currentTabConfig.resultsCount>=0){const e=$(".saveAsDropDown");e.length>0&&!window.editor.queryValid?yasr.header.find(".saveAsDropDown").remove():0===e.length&&window.editor.queryValid&&yasr.updateDownloadDropdown()}}function k(t){return!(e.queryIsRunning&&!e.namespacesLoading)||(t?n.info("New tabs may not be opened while query or update is running."):n.info("Tabs may not be switched while query or update is running."),!1)}e.highlightNextTabChange=!1,e.$on("tabAction",function(n,r){r.relatedTarget&&(t.cancel(r.relatedTarget.timer),$(r.relatedTarget).css("color",""),e.saveTab(M(r.relatedTarget))),e.loadTab(M(r.target));const o=["#ED4F2F","","#ED4F2F"],a=[400,400,400];if(e.highlightNextTabChange){e.highlightNextTabChange=!1;let n=0;$(r.target).css("color",o[n]);const i=function(){++n<o.length?($(r.target).css("color",o[n]),r.target.timer=t(i,a[n])):$(r.target).css("color","")};t(i,a[n])}}),e.$on("deleteAllexeptSelected",function(t,n){e.tabsData=n,e.tabs=n}),e.currentQuery={},e.showSampleQueries=!1,e.savedQuery={},e.sampleQueries={},e.editQueryModal=A("#editQueryContainer"),e.deleteQueryModal=A("#confirmDeleteContainer"),e.saveQueryModal=A("#saveQueryContainer"),e.getResultsDescription=function(){let t;return 0===e.currentTabConfig.resultsCount?t="No results.":(t="Showing results from "+s("currency")(e.currentTabConfig.offset,"",0)+" to "+s("currency")(e.currentTabConfig.resultsCount,"",0),e.currentTabConfig.allResultsCount>0&&(t+=e.countTimeouted?" of at least ":" of ",t+=s("currency")(e.currentTabConfig.allResultsCount,"",0),t+=".")),t},e.getUpdateDescription=function(){return e.currentTabConfig.customUpdateMessage?e.currentTabConfig.customUpdateMessage:void 0===e.currentTabConfig.sizeDelta?"":e.currentTabConfig.sizeDelta<0?"Removed "+Math.abs(e.currentTabConfig.sizeDelta)+" statements.":e.currentTabConfig.sizeDelta>0?"Added "+e.currentTabConfig.sizeDelta+" statements.":"The number of statements did not change."},e.getStaleWarningMessage=function(){const t=60*Math.round((Date.now()-e.currentTabConfig.timeFinished)/6e4);if(t>=3600)return"Possibly stale result (obtained "+e.getHumanReadableSeconds(t)+" ago)."};const N=function(){};angular.element(u).bind("resize",N),e.$on("$destroy",function(){angular.element(u).unbind("resize",N)})}function o(e,t,n){n.queryExists&&(e.queryExists=!0),e.query=angular.copy(n.query),e.title=n.title,e.edit=n.edit,e.okButtonText=n.okButtonText,e.ok=function(){e.form.$valid&&t.close(e.query)},e.cancel=function(){t.dismiss("cancel")}}angular.module("graphdb.framework.core.directives.queryeditor.controllers",["graphdb.framework.utils.localstorageadapter","graphdb.framework.rest.sparql.service"]).controller("QueryEditorCtrl",r).controller("QuerySampleModalCtrl",o),r.$inject=["$scope","$timeout","toastr","$repositories","$modal","ModalService","SparqlRestService","$filter","$window","$jwtAuth","RDF4JRepositoriesRestService","MonitoringRestService","LocalStorageAdapter","LSKeys"],o.$inject=["$scope","$modalInstance","data"]},30:function(e,t,n){"use strict";n.r(t);n(26),n(5);var r=n(187),o=n.n(r),a=n(181),i=n.n(a);function s(e,t,n,r,a,s,u,c,d,l,g,p,f){let y;return{restrict:"AE",scope:!1,templateUrl:"js/angular/core/directives/queryeditor/templates/query-editor.html",link:function(m,T,b){m.nostorage=b.hasOwnProperty("nostorage"),m.notabs=b.hasOwnProperty("notabs"),m.notoolbar=b.hasOwnProperty("notoolbar"),m.notoolbarSaved=b.hasOwnProperty("notoolbarSaved"),m.notoolbarCopy=b.hasOwnProperty("notoolbarCopy"),m.notoolbarInference=b.hasOwnProperty("notoolbarInference"),m.notoolbarSameAs=b.hasOwnProperty("notoolbarSameAs"),m.nostatus=b.hasOwnProperty("nostatus"),m.norun=b.hasOwnProperty("norun"),m.runButtonName="Run",b.runButtonName&&(m.runButtonName=b.runButtonName);if(m.nocount="true"===b.nocount,b.callbackOnChange){const e=m[b.callbackOnChange];"function"==typeof e&&(y=e)}e(function(){!function(m){function T(){angular.element("#wb-sparql-saveQuery")[0].click()}function b(){m.runQuery(!1,!1)}function C(){m.runQuery(!1,!0)}function w(){if(m.tabs.length<2||!m.currentQuery.id||!m.isTabChangeOk(!1))return;let e=x(m.currentQuery.id);e=(e+1)%m.tabs.length;const t=m.tabs[e];S(t.id)}function h(){if(m.tabs.length<2||!m.currentQuery.id||!m.isTabChangeOk(!1))return;let e=x(m.currentQuery.id);-1===--e&&(e=m.tabs.length-1);const t=m.tabs[e];S(t.id)}function S(t){e(function(){let e=$('a[data-id = "'+t+'"]');0===e.length&&(e=$("a[data-id]").first()),e.tab("show")},0)}m.changePagination=function(){m.runQuery(!0,m.explainRequested)},window.editor=o.a.fromTextArea(document.getElementById("query"),{persistent:null,value:"",indentUnit:4,createShareLink:null,cursorHeight:1,sparql:{showQueryButton:!1,acceptHeaderGraph:"application/rdf+json,*/*;q=0.9"},extraKeys:{"Ctrl-Enter":b,"Cmd-Enter":b,"Shift-Ctrl-Enter":C,"Shift-Cmd-Enter":C,"Ctrl-Alt-T":m.addNewTab,"Cmd-Alt-T":m.addNewTab,"Ctrl-S":T,"Cmd-S":T,"Ctrl-Alt-Left":h,"Cmd-Alt-Left":h,"Ctrl-Alt-Right":w,"Cmd-Alt-Right":w}}),window.editor.toastBuildIndex=function(){n.warning("",'<div class="autocomplete-toast"><a href="autocomplete">Autocomplete is OFF<br>Go to Setup -> Autocomplete</a></div>',{allowHtml:!0})},window.editor.toastError=function(e){n.error("Cannot execute autocomplete query. "+getError(e))},window.editor.on("changes",function(){angular.element(".CodeMirror-linenumbers").css("width","1px"),angular.element(".CodeMirror-sizer").css("margin-left","0px"),clearTimeout(m.changesTimeout);const e=!window.editor.queryValid;m.changesTimeout=setTimeout(y?y():function(){const t=x(m.currentQuery.id)+1;$('a[data-id = "'+t+'"]').toggleClass("query-has-error",e).attr("title",e?"Query contains a syntax error. See the relevant line for more information.":"")},200),m.currentQuery.query=window.editor.getValue(),m.currentQuery.queryType=window.editor.getQueryType()}),$(".fullscreenToggleBtns").hide();const v=function(e){$(e.target).removeClass("fa-link").addClass("fa-check").blur(),setTimeout(function(){$(e.target).removeClass("fa-check").addClass("fa-link")},1e3)};window.onbeforeunload=function(){m.nostorage||p.set(f.TABS_STATE,m.tabs),m.saveTab(m.currentQuery.id)};const Q=o.a.executeQuery,E=o.a.getUrlArguments;function q(e,t,n){return{status:e,statusText:t,responseText:n}}let A,R;m.$on("$destroy",function(){m.nostorage||p.set(f.TABS_STATE,m.tabs),o.a.executeQuery=Q,o.a.getUrlArguments=E,m.saveTab(m.currentQuery.id)}),o.a.drawButtons=function(e){e.buttons=$("#yasqe_buttons_mocked")},o.a.getActiveRepository=function(){return a.getActiveRepository()},o.a.getUrlArguments=function(e,t){const n=E(e,t),r=window.editor.getQueryType();return"SELECT"!==r&&"CONSTRUCT"!==r&&"DESCRIBE"!==r||(n.push({name:"limit",value:m.currentTabConfig.pageSize}),m.currentTabConfig.offset=(m.currentTabConfig.page-1)*m.currentTabConfig.pageSize+1,n.push({name:"offset",value:m.currentTabConfig.offset-1})),!m.explainRequested||"SELECT"!==r&&"CONSTRUCT"!==r||n.push({name:"explain",value:"true"}),n},o.a.executeQuery=function(e){if(R&&$(R.resultsContainer).length&&$(R.resultsContainer).empty(),e.options.sparql.headers["X-GraphDB-Catch"]=m.currentTabConfig.pageSize+"; throw",m.currentTrackAlias="query-editor-"+performance.now()+"-"+Date.now(),e.options.sparql.headers["X-GraphDB-Track-Alias"]=m.currentTrackAlias,m.countTimeouted=!1,"query"===e.getQueryMode()?e.options.sparql.endpoint="repositories/"+a.getActiveRepository():"update"===e.getQueryMode()&&(e.options.sparql.endpoint="repositories/"+a.getActiveRepository()+"/statements"),e.options.sparql.args=[{name:"infer",value:m.currentQuery.inference},{name:"sameAs",value:m.currentQuery.sameAs}],m.currentTabConfig.customUpdateMessage="","update"!==window.editor.getQueryMode())return null!=m.currentQuery.outputType?R.options.output=m.currentQuery.outputType:R.options.output="table",m.currentTabConfig.queryType=window.editor.getQueryType(),m.queryStartTime=(new Date).getTime(),Q(e,{setQueryLimit:function(e){return e}});{const t=function(){m.currentTabConfig.queryType="UPDATE",l.getRepositorySize().success(function(t){return m.repoSize=parseInt(t),m.queryStartTime=(new Date).getTime(),Q(e,{})}).error(function(t){return n.warning("Could not get repository size for: "+a.getActiveRepository()+"; "+getError(t)),m.queryStartTime=(new Date).getTime(),Q(e,{})})};g.checkConnector(window.editor.getValue()).then(function(e){if(e.data.command&&!e.data.hasSupport){m.currentTabConfig.queryType="ERROR",m.currentTabConfig.timeFinished=Date.now(),m.currentTabConfig.timeTook=(m.currentTabConfig.timeFinished-m.queryStartTime)/1e3;const t=q(-1,"No support for "+e.data.connectorName,e.data.connectorName+" connectors are not supported because the plugin "+e.data.pluginName+" is not active.");return R.results={getException:function(){return t}},m.setLoader(!1),void M({customError:t},"",null)}if("create"===e.data.command||"repair"===e.data.command){const t="repair"===e.data.command;t?(m.setLoader(!0,"Repairing connector "+e.data.name),m.currentTabConfig.customUpdateMessage="Repaired connector "+e.data.name+"."):(m.setLoader(!0,"Creating connector "+e.data.name),m.currentTabConfig.customUpdateMessage="Created connector "+e.data.name+".");const n=m.$new(!0);n.beingBuiltConnector={percentDone:0,status:{processedEntities:0,estimatedEntities:0,indexedEntities:0,entitiesPerSecond:0},actionName:t?"Repairing":"Creating",eta:"-",inline:!1,iri:e.data.iri,name:e.data.name,doneCallback:function(){A.dismiss("cancel")}},n.getHumanReadableSeconds=m.getHumanReadableSeconds,A=c.open({templateUrl:"pages/connectorProgress.html",controller:"CreateProgressCtrl",size:"lg",backdrop:"static",scope:n})}else"drop"===e.data.command&&(m.setLoader(!0,"Deleting connector "+e.data.name),m.currentTabConfig.customUpdateMessage="Deleted connector "+e.data.name+".");t()},function(){t()})}};const D=o.a.getAjaxConfig;function M(e,t,n){e.getResponseHeader&&e.getResponseHeader("content-type")&&(e.contentType=e.getResponseHeader("content-type"));const r=x(m.executedQueryTab.id),o=m.tabs[r],a={queryType:m.currentTabConfig.queryType,yasrData:e,textStatus:t,jqXhrOrErrorString:n,page:m.currentTabConfig.page,pageSize:m.currentTabConfig.pageSize,allResultsCount:m.currentTabConfig.allResultsCount,resultsCount:m.currentTabConfig.resultsCount,offset:m.currentTabConfig.offset,timeTook:m.currentTabConfig.timeTook,timeFinished:m.currentTabConfig.timeFinished,sizeDelta:m.currentTabConfig.sizeDelta,customUpdateMessage:m.currentTabConfig.customUpdateMessage,errorMessage:m.currentTabConfig.errorMessage,warningMessage:m.currentTabConfig.warningMessage};"ERROR"!==m.currentTabConfig.queryType&&"UPDATE"!==m.currentTabConfig.queryType&&"ASK"!==m.currentTabConfig.queryType&&(a.outputType=m.yasr.options.output),angular.extend(m.currentQuery,a),angular.extend(o,a),m.nostorage||p.set(f.TABS_STATE,m.tabs),$('a[data-id = "'+m.executedQueryTab.id+'"]').tab("show")}function x(e){for(let t=0;t<m.tabs.length;t++){const n=m.tabs[t];if(n.id===e)return t}}function k(e){return angular.isDefined(e)&&"false"!==e}function N(e,n,r){const o=m.getExistingTabId(e),a=m.$on("tabLoaded",function(){angular.isDefined(n)&&(m.currentQuery.inference=k(n)),angular.isDefined(r)&&(m.currentQuery.sameAs=k(r)),k(t.search().execute)&&("update"===window.editor.getQueryMode()?u.openSimpleModal({title:"Confirm execute",message:"This is an update and it may change the data in the repository.<br>Are you sure you want to execute it automatically?",warning:!0}).result.then(function(){m.runQuery(!1)}):m.runQuery(!1)),a()});m.highlightNextTabChange=!0,angular.isDefined(o)?S(o):m.addNewTab(null,e.name,e.body)}function z(){if(t.search().savedQueryName)e=t.search().savedQueryName,r=t.search().owner,o=t.search().infer,a=t.search().sameAs,s.getSavedQuery(e,r).success(function(e){N(e,o,a)}).error(function(t){n.error("Could not get data for saved query: "+e+"; "+getError(t))});else if(t.search().query){const e={name:t.search().name,body:t.search().query};N(e,t.search().infer,t.search().sameAs)}else{const e=p.get(f.TABS_STATE_CURRENT_ID);S(e)}var e,r,o,a}function O(){m.getNamespaces(),o.a.signal(window.editor,"repositoryOrAuthorizationChanged",a.getActiveRepository(),d.getAuthToken()),z()}o.a.getAjaxConfig=function(e,t){const n=D(e,t);return _.extend(n.headers,{Authorization:d.getAuthToken()}),n},m.copyToClipboardQuery=function(e,t){u.openCopyToClipboardModal(function(e,t){let n=[location.protocol,"//",location.host,location.pathname].join("");return e?(n=n+"?savedQueryName="+encodeURIComponent(e),null!=t&&(n+="&owner="+encodeURIComponent(t))):n=n+"?"+$.param({name:m.currentQuery.name,infer:m.currentQuery.inference,sameAs:m.currentQuery.sameAs,query:window.editor.getValue()}),n}(e,t))},m.copyToClipboardResult=function(e){u.openCopyToClipboardModal(e)},m.goToVisual=function(){const e={query:window.editor.getValue(),sameAs:m.currentQuery.sameAs,inference:m.currentQuery.inference};t.path("graphs-visualizations").search(e)},$("textarea").on("paste",function(){e(function(){m.addKnownPrefixes()},0)}),R=i()(document.getElementById("yasr"),{getUsedPrefixes:{},persistency:!1}),window.yasr=R,R.afterCopy=v,R.getQueryResultsAsFormat=function(e){const o=$("#wb-download");o.attr("action","repositories/"+a.getActiveRepository()),$("#wb-download-query").val(m.currentQuery.query),window.editor.getValue()!==m.currentQuery.query&&n.warning("The query in your editor does not match the query results. Download will save the results from the last executed query."),$("#wb-download-infer").val(m.currentQuery.inference),$("#wb-download-sameAs").val(m.currentQuery.sameAs);const i=r["com.ontotext.graphdb.auth"+t.port()];i&&$("#wb-auth-token").val(i),$("#wb-download-accept").val(e),o.submit()},window.editor.options.sparql.handlers.complete=function(t,r,o){function a(){M(t,r,o)}if(A&&A.dismiss("cancel"),null===window.editor)return void m.setLoader(!1);if(m.currentTabConfig.errorMessage=t.getResponseHeader("X-GraphDB-Error"),m.currentTabConfig.warningMessage=t.getResponseHeader("X-GraphDB-Warning"),R.currentQuery=m.currentQuery,m.currentTabConfig.timeFinished=Date.now(),m.currentTabConfig.timeTook=(m.currentTabConfig.timeFinished-m.queryStartTime)/1e3,t.status>=400)return t.responseText=t.responseText.replace(/^([^: ]+: )+/,""),m.currentTabConfig.queryType="ERROR",a(),R.setResponse(t,r,o),void m.setLoader(!1);if(0===t.status){m.currentTabConfig.queryType="ERROR";const e=q(-1,"Request was aborted","The request has been aborted. There are no results to show.");return R.results={getException:function(){return e}},m.setLoader(!1),void M({customError:e},"",null)}let i;if(m.setLoader(!1),"update"===window.editor.getQueryMode())i=function(){l.getRepositorySize().success(function(e){let t;void 0!==m.repoSize&&(t=Number(e)-m.repoSize),m.currentTabConfig.sizeDelta=t,a()}).error(function(e){n.warning("Could not get repository size for: "+m.getActiveRepository()+"; "+getError(e)),m.currentTabConfig.sizeDelta=void 0,a()})};else{if(200===t.status){let e=-1;const n=t.getResponseHeader("Content-Type");0===n.indexOf("application/sparql-results+json")?t.responseJSON.results&&(e=t.responseJSON.results.bindings.length):0===n.indexOf("application/rdf+json")&&(e=0,_.each(t.responseJSON,function(t){_.each(t,function(t){e+=t.length})})),e>=0&&(m.nocount||1===m.currentTabConfig.offset&&e<m.currentTabConfig.pageSize)&&(t.status=204,m.currentTabConfig.allResultsCount=e)}m.setLoader(!0,"Rendering results",null,!0),i=function(){R.setResponse(t,r,o),m.$apply(function(){m.currentTabConfig.resultsCount=m.currentTabConfig.offset+R.resultsCount-1}),a(),m.setLoader(!1)}}e(function(){i(),"CONSTRUCT"!==window.editor.getQueryType()?($(".yasr_btnGroup.nav.nav-tabs li a.disabled").removeClass("disabled").css("font-weight","400"),$(".yasr_btnGroup.nav.nav-tabs li.disabled a").addClass("disabled").css("font-weight","200"),"DESCRIBE"===window.editor.getQueryType()&&$(".yasr_btnGroup.nav.nav-tabs li a").removeClass("disabled").css("font-weight","400")):"CONSTRUCT"===window.editor.getQueryType()&&$(".yasr_btnGroup.nav.nav-tabs li a.disabled").removeClass("disabled").css("font-weight","400"),$("#yasr").css("padding","0"),$(".yasr_btnGroup li:nth-child(2)").hasClass("active")&&e(function(){$(".yasr_btnGroup li:nth-child(2) a").get(0).click()},100),$("#wb-sparql-addNewTab").click(function(){$(".dataTables_filter").hide(),$(".resultsTable").hide()})},100)},window.editor.options.sparql.handlers.countCallback=function(e,t,n){200===e.status?R.setResultsCount(e,t,n):(R.allCount=m.currentTabConfig.resultsCount,m.countTimeouted=!0),m.$apply(function(){m.currentTabConfig.allResultsCount=R.allCount});const r=m.tabs[x(m.currentQuery.id)];r.allResultsCount=R.allCount,m.saveTab(r.id)},window.editor.options.sparql.handlers.resetResults=function(){},m.yasr=R,m.$watch("yasr.options.output",function(e){if(e&&"UPDATE"!==m.currentTabConfig.queryType&&"ASK"!==m.currentTabConfig.queryType){const t=m.tabs[x(m.currentQuery.id)];angular.isDefined(t)&&m.currentTabConfig.queryType&&t.outputType!==e&&(t.outputType=m.currentQuery.outputType=e,m.saveTab(t.id))}}),m.$watch("namespaces",function(){m.namespaces&&(R&&R.options&&m.namespaces&&(R.options.getUsedPrefixes=m.namespaces),o.a.signal(window.editor,"namespacesChanged",m.namespaces))}),$(document).mouseup(function(e){const t=$("#sampleQueriesCollapse");!t.is(e.target)&&0===t.has(e.target).length&&m.showSampleQueries&&m.toggleSampleQueries()}),a.getActiveRepository()&&O();m.$on("repositoryIsSet",function(){a.getActiveRepository()&&O()}),e(function(){angular.element(document).find(".CodeMirror textarea:first-child").focus()},50)}(m)},150)}}}angular.module("graphdb.framework.core.directives.queryeditor.queryeditor",["ngCookies","graphdb.framework.rest.connectors.service","graphdb.framework.utils.localstorageadapter"]).directive("queryEditor",s),s.$inject=["$timeout","$location","toastr","$cookies","$repositories","SparqlRestService","ModalService","$modal","$jwtAuth","RDF4JRepositoriesRestService","ConnectorsRestService","LocalStorageAdapter","LSKeys"]}}]);
//# sourceMappingURL=7.432d668f0c8301db225f.bundle.js.map